---
import Base from '~/layouts/Base.astro';
import Prose from '~/components/Prose.astro';

const posts = (await Astro.glob('../../../blog/*.{md,mdx}')).sort(
	(a, b) => new Date(b.frontmatter.pubDate).valueOf() - new Date(a.frontmatter.pubDate).valueOf()
);
const dateFormatter = new Intl.DateTimeFormat('en-US', { dateStyle: 'medium' }).format;
---

<Base title="Blog">
	<div class="pb-12">
		<Prose>
			<h1>Blog</h1>
			<p>
				Rambling, ranting, and ravingâ€¦ But mostly just whatever seems important in the moment about JavaScript, frontend
				development, and life surrounding me.
			</p>
		</Prose>
	</div>
	<section>
		<ul class="flex flex-col gap-4">
			{
				posts.map((post) => {
					if (post.frontmatter.draft) {
						return null;
					}

					const filename = post.file.split('/blog/')[1].replace(/\.mdx?$/, '');
					const match = filename?.match(/^(?<year>\d+)-(?<month>\d+)-(?<day>\d+)-(?<slug>.+)$/);
					if (!match) {
						return null;
					}
					const slug = `/blog/${Object.values(match.groups || {}).join('/')}`;

					return (
						<li class="mb-4 grid grid-cols-6 gap-4">
							<time class="text-right leading-8 text-slate-500" datetime={post.frontmatter.pubDate}>
								{dateFormatter(new Date(post.frontmatter.pubDate))}
							</time>
							<div class="col-span-5">
								<a
									class="text-2xl font-bold text-blue-600 decoration-4 underline-offset-4 hover:underline dark:text-blue-200"
									href={slug}
								>
									{post.frontmatter.title}
								</a>
								<Prose>
									<p>{post.frontmatter.description}</p>
								</Prose>
							</div>
						</li>
					);
				})
			}
		</ul>
	</section>
</Base>
